G90        ; Abs pos
T0         ; select tool 0

; Start pre-heating bed (will take long)
M140 S100     ; non-blocking bed

; Home
G28           ; Home all axis

; Bed takes a long amount of time, heat close to desired without going further then push to final
M190 S100     ; blocking bed
M140 S105     ; non-blocking bed

; Start heating head and once hot retract bit of filament (still heating bed)
M109 S180     ; blocking head
M83           ; relative extruder mode
G1 E-30 F300  ; Retract a little bit, slowly

; Once all hot, level bed
M116          ; Wait for all to reach temp
M561          ; Clear any bed transform
M98 P"/macros/z_probe/level_inductive.g"

; Once level ask for head clean
M98 P"/macros/motion/xyz_front_high.g"
M300 S2000 P200  ; beep
M291 P"Please clean my head" S3

; Determine Z by switch (and swap back)
M98 P"/macros/z_probe/height_switch.g"
M98 P"/macros/z_probe/use_inductive.g"

; Restore mesh
G29 S1  ; Load previously probed bed mesh
